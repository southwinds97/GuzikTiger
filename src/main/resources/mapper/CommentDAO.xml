<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.edu.springboot.qna.ICommentService">
   
   <select id="getTotalCount" resultType="int"
   	parameterType="com.edu.springboot.qna.CommentDTO">
   		SELECT COUNT(*) from qna_comment
   		where board_idx=#{board_idx}
   	</select>
   	<select id="getBoardIdx" parameterType="com.edu.springboot.qna.CommentDTO">
   		SELECT * FROM qna_comment where board_idx=#{board_idx}
   	</select>
   	
	<select id="listCom" resultType="com.edu.springboot.qna.CommentDTO"
		parameterType="com.edu.springboot.ParameterDTO">
		SELECT * FROM (
        SELECT Tb.*, rownum rNum FROM (
            SELECT * FROM qna_comment
            WHERE board_idx = #{qna.getIdx()}
            ORDER BY idx DESC
        ) Tb
    )    
    WHERE rNum <![CDATA[>=]]> #{start} AND rNum <![CDATA[<=]]> #{end}
	</select>   	
	
	<insert id="write" parameterType="com.edu.springboot.qna.CommentDTO">
    INSERT INTO qna_comment (idx, board_idx, name, comments, password, secretYN)
    VALUES
    (qna_comment_seq.nextval, #{board_idx, jdbcType=VARCHAR}, #{name, jdbcType=VARCHAR}, #{comments, jdbcType=VARCHAR},
    	#{password, jdbcType=VARCHAR}, #{secretYN, jdbcType=VARCHAR})
	</insert>

	<select id="view" resultType="com.edu.springboot.qna.CommentDTO"
		parameterType="com.edu.springboot.qna.CommentDTO">
		SELECT * FROM qna_comment WHERE idx=#{idx}
	</select>
	
	<update id="edit" parameterType="com.edu.springboot.qna.CommentDTO">
		UPDATE qna_comment SET
		product=#{product, jdbcType=VARCHAR}, category=#{category, jdbcType=VARCHAR}, content=#{content, jdbcType=VARCHAR},
		password=#{password, jdbcType=VARCHAR}, uccURL=#{uccURL, jdbcType=VARCHAR},
		secretYN=#{secretYN, jdbcType=VARCHAR}, ofile=#{ofile, jdbcType=VARCHAR}, sfile=#{sfile, jdbcType=VARCHAR}
		WHERE idx=#{idx}
	</update>
	
	<delete id="delete">
		DELETE FROM qna_comment WHERE idx=#{param1}
	</delete>
</mapper>